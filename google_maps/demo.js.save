var demo = (function (demo) {

  demo.maps = (function (maps) {

    var address;
    var map;
    var mapAPIKey = 'AIzaSyCnHEfrA5ra6H6SySHr3OFF-OJ-FFRK0ug';
    var mapElementID = '#map_canvas';
    var mapScriptURL = 'http://maps.googleapis.com/maps/api/js?v=3.9&key=' + mapAPIKey + '&sensor=false';
    var marker;

    var processGeocoderResults = function (results, status) {
      if (status == google.maps.GeocoderStatus.OK) {
        map.setCenter(results[0].geometry.location);
        marker = new google.maps.Marker({
          map: map,
          position: results[0].geometry.location
        });
      } else {
        alert('There was an error processing the map data.');
      }
    };

    var findMapElementInDOM = function () {
      return $(mapElementID).get(0);
    };

    maps.setAddress = function (newAddress) {
      address = newAddress;
    };

    maps.initializeMap = function () {
      var mapOptions = {
        // Denver LatLng: 39.737567, -104.98471790000002
        // Pinnacol LatLng: 39.718019, -104.90065300000003
        center: new google.maps.LatLng(39.737567, -104.98471790000002),
        zoom: 12,
        mapTypeId: google.maps.MapTypeId.ROADMAP
      };
      map = new google.maps.Map(findMapElementInDOM(), mapOptions);

      if (address) {
        var request = {address: address};
        var geocoder = new google.maps.Geocoder();
        geocoder.geocode(request, processGeocoderResults);
      }
    };

    maps.injectMapScriptWithCallback = function () {
      var script = $('<script type="text/javascript"></script>');
      script.attr('src', mapScriptURL + '&callback=demo.maps.initializeMap');
      $('body').append(script);
    };

    return maps;
  })(demo.maps || {});

  return demo;
})(demo || {}, jQuery);

$(function () {
  demo.maps.setAddress('12975 Vallejo Circle, Westminster, CO 80234');
  demo.maps.injectMapScriptWithCallback();
});
